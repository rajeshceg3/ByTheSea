<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mamallapuram | Coastal Serenity</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,500;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        :root {
            /* Palette: Coastal Pastel */
            --c-bg: #F0F4F8;          /* Alice Blue / Soft Sky */
            --c-text-main: #2D3748;   /* Dark Slate */
            --c-text-sec: #718096;    /* Cool Grey */
            --c-accent-warm: #F6AD55; /* Soft Orange/Peach */
            --c-accent-cool: #38B2AC; /* Teal */
            --c-glass: rgba(255, 255, 255, 0.85); /* Slightly more opaque for better readability */
            --c-glass-border: rgba(255, 255, 255, 0.6);

            --f-head: 'Playfair Display', serif;
            --f-body: 'Lato', sans-serif;

            --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --ease-smooth: cubic-bezier(0.4, 0.0, 0.2, 1);
            --dur-entry: 800ms;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body, html {
            height: 100%;
            width: 100%;
            background-color: var(--c-bg);
            font-family: var(--f-body);
            color: var(--c-text-main);
            overflow: hidden;
        }

        /* Map Styling */
        #map {
            height: 100%;
            width: 100%;
            opacity: 0;
            background: var(--c-bg);
            transition: opacity 1s ease-out;
            z-index: 1;
        }

        /* Tint the map tiles to match the pastel theme */
        .leaflet-tile-pane {
            /* Subtle blue/purple shift for sea/sky vibe */
            filter: grayscale(100%) sepia(8%) hue-rotate(190deg) brightness(102%) contrast(92%);
        }

        /* UI Layer */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 2.5rem;
        }

        /* Glassmorphism Card Utility */
        .glass-card {
            background: var(--c-glass);
            backdrop-filter: blur(20px) saturate(140%);
            -webkit-backdrop-filter: blur(20px) saturate(140%);
            border: 1px solid var(--c-glass-border);
            box-shadow:
                inset 0 1px 0 rgba(255,255,255,0.8),
                0 4px 20px rgba(0, 0, 0, 0.03),
                0 20px 40px rgba(0, 0, 0, 0.04);
            border-radius: 20px;
        }

        /* Header */
        header {
            pointer-events: auto;
            align-self: flex-start;
            padding: 1.8rem 2.5rem;
            opacity: 0;
            transform: translateY(-20px);
            animation: slideDown var(--dur-entry) var(--ease-smooth) 200ms forwards;
        }

        h1 {
            font-family: var(--f-head);
            font-weight: 700;
            font-size: 2.4rem;
            color: var(--c-text-main);
            line-height: 1;
            letter-spacing: -0.03em;
            margin-bottom: 0.2rem;
        }

        .subtitle {
            display: block;
            font-family: var(--f-body);
            font-weight: 400;
            font-size: 0.85rem;
            color: var(--c-text-sec);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            opacity: 0.8;
        }

        /* Info Panel */
        .info-panel {
            align-self: flex-start;
            width: 380px;
            max-width: 88vw;
            padding: 2.5rem;
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            transition: all 0.6s var(--ease-smooth);
            pointer-events: auto;
            position: relative;
            will-change: transform, opacity;
        }

        .info-panel.active {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .panel-content {
            position: relative;
            z-index: 2;
        }

        .info-title {
            font-family: var(--f-head);
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--c-text-main);
            letter-spacing: -0.01em;
            line-height: 1.1;
        }

        .info-body {
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--c-text-sec);
            font-weight: 300;
        }

        .panel-close {
            position: absolute;
            top: 1.2rem;
            right: 1.2rem;
            width: 32px;
            height: 32px;
            cursor: pointer;
            opacity: 0.4;
            transition: all 0.2s;
            border-radius: 50%;
            background: rgba(0,0,0,0.03);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            padding: 0;
            outline: none;
        }
        .panel-close:hover, .panel-close:focus {
            opacity: 1;
            background: rgba(0,0,0,0.08);
            transform: scale(1.1);
        }
        .panel-close:focus-visible {
            box-shadow: 0 0 0 2px var(--c-accent-cool);
        }
        .panel-close svg {
            width: 14px;
            height: 14px;
            fill: var(--c-text-main);
            pointer-events: none;
        }

        /* Markers */
        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: z-index 0.1s;
            will-change: transform;
        }

        .pin {
            width: 18px;
            height: 18px;
            background: var(--c-accent-warm);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 4px 12px rgba(246, 173, 85, 0.4);
            transition: transform 0.4s var(--ease-elastic), background 0.3s;
            z-index: 2;
            border: 2px solid #FFF;
        }

        .pulse {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(246, 173, 85, 0.25);
            border-radius: 50%;
            z-index: 1;
            animation: pulse 4s infinite ease-out;
            pointer-events: none;
        }

        .custom-marker:hover .pin {
            transform: scale(1.3);
            background: var(--c-accent-cool);
            box-shadow: 0 6px 20px rgba(56, 178, 172, 0.4);
            border-color: #F0F4F8;
        }

        .custom-marker:hover .pulse {
            background: rgba(56, 178, 172, 0.2);
            animation-duration: 2s;
        }

        @keyframes pulse {
            0% { transform: scale(0.2); opacity: 0.8; }
            50% { opacity: 0.4; }
            100% { transform: scale(1.2); opacity: 0; }
        }

        @keyframes slideDown {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Zoom Controls Override */
        .leaflet-control-zoom {
            border: none !important;
            margin-bottom: 3rem !important;
            margin-right: 3rem !important;
        }
        .leaflet-control-zoom a {
            background: var(--c-glass) !important;
            backdrop-filter: blur(10px) !important;
            color: var(--c-text-main) !important;
            border: 1px solid var(--c-glass-border) !important;
            border-radius: 12px !important;
            width: 48px !important;
            height: 48px !important;
            line-height: 48px !important;
            margin-bottom: 12px !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05) !important;
            font-weight: 300 !important;
            font-size: 1.4rem !important;
            transition: all 0.2s !important;
        }
        .leaflet-control-zoom a:hover {
            background: #FFF !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08) !important;
        }

        /* Attribution */
        .leaflet-control-attribution {
            background: transparent !important;
            font-family: var(--f-body);
            color: var(--c-text-sec);
            opacity: 0.5;
            margin-right: 1.5rem;
            margin-bottom: 0.8rem;
            font-size: 0.7rem !important;
        }
        .leaflet-control-attribution a {
            color: var(--c-text-sec) !important;
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .ui-layer { padding: 1.5rem; }
            header { padding: 1.2rem 1.5rem; }
            h1 { font-size: 1.8rem; }
            .info-panel { width: 100%; bottom: 0; padding: 1.5rem; }
            .leaflet-control-zoom { display: none; } /* Hide zoom on mobile */
        }
    </style>
</head>
<body>
    <div id="map" aria-label="Map of Mamallapuram" role="application"></div>

    <div class="ui-layer">
        <header class="glass-card">
            <h1>Mamallapuram</h1>
            <span class="subtitle">Stone. Salt. Silence.</span>
        </header>

        <div id="panel" class="info-panel glass-card">
            <button class="panel-close" onclick="hidePanel()" aria-label="Close details">
                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div class="panel-content">
                <div class="info-title" id="panel-title"></div>
                <div class="info-body" id="panel-body"></div>
            </div>
        </div>
    </div>

    <script>
        const locations = [
            {
                name: "Shore Temple",
                coords: [12.6111, 80.1973],
                text: "Granite against the tide. The last of seven pagodas, standing where the ocean ends, bearing witness to centuries of monsoons and trade."
            },
            {
                name: "Descent of the Ganges",
                coords: [12.6163, 80.1918],
                text: "A canvas of living rock. Elephants, gods, and ascetics frozen in a moment of celestial arrival, carved with a breathing realism."
            },
            {
                name: "Krishnaâ€™s Butter Ball",
                coords: [12.6175, 80.1923],
                text: "Improbable balance. A colossal monolith resting on a slope, defying gravity and the urge to roll, playful yet immovable."
            },
            {
                name: "Pancha Rathas",
                coords: [12.6083, 80.1894],
                text: "Chariots of stone. Five monolithic structures, each carved from a single rock, standing as eternal testaments to Pallava architecture."
            },
            {
                name: "Mahabalipuram Lighthouse",
                coords: [12.6144, 80.1947],
                text: "A silent watch over the Coromandel coast. Its light cuts through the salt air, guiding ships past the ancient granite shores."
            }
        ];

        const map = L.map('map', {
            center: [12.6140, 80.1935],
            zoom: 15,
            minZoom: 14,
            maxZoom: 18,
            zoomControl: false,
            attributionControl: true
        });

        L.control.zoom({ position: 'bottomright' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        const panel = document.getElementById('panel');
        const panelTitle = document.getElementById('panel-title');
        const panelBody = document.getElementById('panel-body');
        let activeMarker = null;
        const markers = {};

        locations.forEach(loc => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="pulse"></div><div class="pin" role="button" tabindex="0" aria-label="${loc.name}"></div>`,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });

            const marker = L.marker(loc.coords, { icon: icon });
            markers[loc.name] = marker;

            marker.on('add', () => {
                const el = marker.getElement();
                if (el) {
                    el.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            marker.fire('click');
                        }
                    });
                }
            });

            marker.addTo(map);

            marker.on('click', (e) => {
                if (activeMarker === loc.name) return;

                const isMobile = window.innerWidth < 600;
                // Offset: negative Y moves center down, putting marker UP (above bottom panel)
                const offset = isMobile ? [0, -150] : [150, 0];

                const targetZoom = Math.max(map.getZoom(), 16);
                const targetPoint = map.project(e.latlng, targetZoom).subtract(offset);
                const targetLatLng = map.unproject(targetPoint, targetZoom);

                map.flyTo(targetLatLng, targetZoom, {
                    animate: true,
                    duration: 1.2,
                    easeLinearity: 0.25
                });
                showPanel(loc);
                L.DomEvent.stopPropagation(e);
            });

            marker.on('mouseover', function() { this.setZIndexOffset(1000); });
            marker.on('mouseout', function() {
                if (activeMarker !== loc.name) {
                    this.setZIndexOffset(0);
                }
            });
        });

        function showPanel(data) {
            if (activeMarker === data.name && panel.classList.contains('active')) return;

            if (activeMarker && markers[activeMarker]) {
                markers[activeMarker].setZIndexOffset(0);
            }

            panelTitle.innerText = data.name;
            panelBody.innerText = data.text;
            panel.classList.add('active');
            activeMarker = data.name;

            if (markers[activeMarker]) {
                markers[activeMarker].setZIndexOffset(1000);
            }
        }

        function hidePanel() {
            panel.classList.remove('active');
            if (activeMarker && markers[activeMarker]) {
                markers[activeMarker].setZIndexOffset(0);
            }
            activeMarker = null;
        }

        map.on('click', () => hidePanel());

        window.onload = () => {
            document.getElementById('map').style.opacity = '1';
        };
    </script>
</body>
</html>
