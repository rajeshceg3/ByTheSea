<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>Mamallapuram | Coastal Serenity</title>
    <meta name="description" content="An immersive journey through the stone and silence of Mamallapuram.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /*
         * DESIGN SYSTEM: Coastal Serenity
         * Theme: Ethereal, Sophisticated, Organic
         */
        :root {
            /* Palette - Refined Pastel */
            --c-bg: #F5F7FA;
            --c-surface: #FFFFFF;

            /* Text Colors */
            --c-text-primary: #2D3748;
            --c-text-secondary: #718096;
            --c-text-accent: #319795; /* Teal */

            /* Accents */
            --c-accent-warm: #ED8936; /* Soft Orange */
            --c-accent-warm-light: #FEEBC8;
            --c-accent-cool: #38B2AC; /* Teal */
            --c-accent-cool-light: #E6FFFA;

            /* Glassmorphism Variables */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow:
                0 4px 6px -1px rgba(0, 0, 0, 0.02),
                0 2px 4px -1px rgba(0, 0, 0, 0.02),
                0 10px 15px -3px rgba(0, 0, 0, 0.05);
            --glass-blur: blur(16px);

            /* Typography */
            --f-display: 'Playfair Display', serif;
            --f-body: 'Lato', sans-serif;

            /* Transitions */
            --ease-elastic: cubic-bezier(0.68, -0.6, 0.32, 1.6);
            --ease-smooth: cubic-bezier(0.4, 0.0, 0.2, 1);

            /* Spacing */
            --space-unit: clamp(1rem, 2vw, 2rem);
        }

        /*
         * RESET & BASE
         */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--c-bg);
            font-family: var(--f-body);
            color: var(--c-text-primary);
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /*
         * MAP CONTAINER & STYLING
         */
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0;
            animation: revealMap 1.5s var(--ease-smooth) forwards;
        }

        /* SVG Noise Overlay for Texture */
        .texture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0.07;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Map Tiles Custom Filter */
        .leaflet-tile-pane {
            filter: grayscale(1) brightness(1.05) contrast(0.95) sepia(0.2) hue-rotate(180deg) saturate(0.5);
            transition: filter 0.5s ease;
        }

        /*
         * UI LAYOUT
         */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: grid;
            grid-template-rows: auto 1fr auto;
            grid-template-columns: 1fr;
            padding: var(--space-unit);
        }

        /*
         * COMPONENTS
         */

        /* Header */
        .header-container {
            grid-row: 1;
            justify-self: start;
            pointer-events: auto;
            max-width: 500px;
            opacity: 0;
            animation: slideDown 1s var(--ease-smooth) 0.5s forwards;
        }

        .brand-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem 2.5rem;
            box-shadow: var(--glass-shadow);
        }

        h1 {
            font-family: var(--f-display);
            font-weight: 700;
            font-size: clamp(2rem, 4vw, 3rem);
            line-height: 1.1;
            letter-spacing: -0.02em;
            color: var(--c-text-primary);
            margin-bottom: 0.75rem;
        }

        .subtitle {
            font-family: var(--f-body);
            font-size: 0.85rem;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            color: var(--c-text-accent);
            display: flex;
            align-items: center;
        }

        .subtitle::before {
            content: '';
            display: block;
            width: 30px;
            height: 1px;
            background-color: var(--c-text-accent);
            margin-right: 15px;
            opacity: 0.7;
        }

        /* Info Panel (Bottom Sheet on Mobile, Floating Card on Desktop) */
        .panel-container {
            grid-row: 2 / -1; /* Spans to bottom */
            align-self: end;
            justify-self: start;
            width: 100%;
            max-width: 440px;
            pointer-events: none; /* Container is passive */
        }

        .info-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 24px;
            padding: 2.5rem;
            pointer-events: auto;
            position: relative;

            /* Hidden State */
            opacity: 0;
            transform: translateY(20px) scale(0.98);
            visibility: hidden;
            transition: all 0.5s var(--ease-smooth);
        }

        .info-card.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
        }

        .info-title {
            font-family: var(--f-display);
            font-size: 2rem;
            font-weight: 600;
            color: var(--c-text-primary);
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .info-body {
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--c-text-secondary);
            font-weight: 300;
        }

        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.05);
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--c-text-primary);
        }

        .close-btn:hover {
            background: #fff;
            transform: rotate(90deg);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .close-btn:focus-visible {
            outline: 2px solid var(--c-accent-cool);
            outline-offset: 2px;
        }

        /*
         * CUSTOM MARKERS
         */
        .custom-marker {
            background: transparent;
            will-change: transform;
        }

        .marker-wrapper {
            position: relative;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.4s var(--ease-elastic);
        }

        .marker-wrapper:hover {
            transform: scale(1.2);
            z-index: 100;
        }

        .marker-dot {
            width: 14px;
            height: 14px;
            background-color: var(--c-surface);
            border: 3px solid var(--c-accent-warm);
            border-radius: 50%;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .marker-ripple {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 1px solid var(--c-accent-warm);
            border-radius: 50%;
            opacity: 0;
            animation: ripple 3s infinite;
        }

        .marker-ripple:nth-child(2) {
            animation-delay: 1s;
        }

        /* Active Marker State */
        .custom-marker.active-marker .marker-dot {
            background-color: var(--c-accent-warm);
            border-color: var(--c-surface);
            transform: scale(1.3);
        }

        .custom-marker.active-marker .marker-ripple {
            border-color: var(--c-accent-cool);
            animation-duration: 2s;
        }

        @keyframes ripple {
            0% { transform: scale(0.4); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /*
         * ANIMATIONS
         */
        @keyframes revealMap {
            from { opacity: 0; transform: scale(1.05); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /*
         * LEAFLET OVERRIDES
         */
        .leaflet-control-zoom {
            border: none !important;
            margin: var(--space-unit) !important;
            box-shadow: var(--glass-shadow) !important;
        }

        .leaflet-control-zoom a {
            background: var(--glass-bg) !important;
            color: var(--c-text-primary) !important;
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid rgba(0,0,0,0.05) !important;
            width: 40px !important;
            height: 40px !important;
            line-height: 40px !important;
            font-size: 1.25rem !important;
            transition: all 0.2s;
        }

        .leaflet-control-zoom a:first-child { border-top-left-radius: 12px !important; border-top-right-radius: 12px !important; }
        .leaflet-control-zoom a:last-child { border-bottom-left-radius: 12px !important; border-bottom-right-radius: 12px !important; }

        .leaflet-control-zoom a:hover {
            background: #fff !important;
            color: var(--c-text-accent) !important;
        }

        .leaflet-control-attribution {
            background: rgba(255,255,255,0.6) !important;
            padding: 4px 8px !important;
            border-radius: 4px;
            font-size: 10px !important;
            color: var(--c-text-secondary) !important;
        }

        /*
         * RESPONSIVE
         */
        @media (max-width: 768px) {
            .ui-layer {
                grid-template-rows: auto 1fr auto;
                padding: 1rem;
            }

            .header-container {
                max-width: 100%;
                width: 100%;
            }

            .brand-card {
                padding: 1.5rem;
                background: rgba(255,255,255,0.85); /* Slightly more opaque on mobile */
            }

            h1 { margin-bottom: 0.5rem; }

            .panel-container {
                position: absolute; /* Take out of grid flow to force bottom */
                bottom: 1rem;
                left: 1rem;
                right: 1rem;
                width: auto;
                max-width: none;
                z-index: 100;
            }

            .info-card {
                padding: 1.5rem 2rem;
                max-height: 50vh;
                overflow-y: auto;
            }

            .leaflet-control-zoom { display: none; }
        }
    </style>
</head>
<body>

    <!-- Texture Overlay for Grain Effect -->
    <div class="texture-overlay"></div>

    <div id="map-container">
        <div id="map" style="height: 100%; width: 100%;" role="application" aria-label="Interactive Map of Mamallapuram"></div>
    </div>

    <div class="ui-layer">
        <header class="header-container">
            <div class="brand-card">
                <h1>Mamallapuram</h1>
                <div class="subtitle">Stone &bull; Salt &bull; Silence</div>
            </div>
        </header>

        <div class="panel-container">
            <aside id="info-panel" class="info-card" aria-hidden="true">
                <button class="close-btn" id="close-panel" aria-label="Close details">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
                <h2 class="info-title" id="info-title">Title Here</h2>
                <div class="info-body" id="info-body">
                    Description goes here.
                </div>
            </aside>
        </div>
    </div>

    <script>
        // --- DATA ---
        const locations = [
            {
                name: "Shore Temple",
                coords: [12.6111, 80.1973],
                text: "Standing defiant against the Bay of Bengal since the 8th century, this granite structural temple captures the first light of dawn. It is the last survivor of the legendary Seven Pagodas."
            },
            {
                name: "Descent of the Ganges",
                coords: [12.6163, 80.1918],
                text: "A masterpiece of narrative art carved into two giant boulders. It depicts the celestial river Ganges descending from the heavens, witnessed by gods, animals, and sages in intricate detail."
            },
            {
                name: "Krishnaâ€™s Butter Ball",
                coords: [12.6175, 80.1923],
                text: "Vaanirai Kal (Stone of Sky God) is a 250-ton rock perched precariously on a slope. Defying gravity and attempts to move it, it remains a playful enigma of nature."
            },
            {
                name: "Pancha Rathas",
                coords: [12.6083, 80.1894],
                text: "Five monolithic pyramidal structures named after the Pandavas. Carved from a single large rock, these 'chariots' showcase the evolution of Dravidian architecture."
            },
            {
                name: "Mahabalipuram Lighthouse",
                coords: [12.6144, 80.1947],
                text: "A beacon guiding sailors since 1904. Climb the spiral stairs for a panoramic view of the ancient town, the shimmering ocean, and the spread of casuarina trees."
            }
        ];

        // --- INIT MAP ---
        const map = L.map('map', {
            center: [12.6140, 80.1935],
            zoom: 15,
            minZoom: 14,
            maxZoom: 18,
            zoomControl: false,
            attributionControl: true,
            scrollWheelZoom: 'center'
        });

        // Add Zoom Control at bottom right
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // Tile Layer - CartoDB Light
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // --- UI REFS ---
        const panel = document.getElementById('info-panel');
        const panelTitle = document.getElementById('info-title');
        const panelBody = document.getElementById('info-body');
        const closeBtn = document.getElementById('close-panel');

        let activeMarkerName = null;
        const markers = {};

        // --- MARKER LOGIC ---
        locations.forEach(loc => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div class="marker-wrapper" role="button" tabindex="0" aria-label="Explore ${loc.name}">
                        <div class="marker-ripple"></div>
                        <div class="marker-ripple"></div>
                        <div class="marker-dot"></div>
                    </div>
                `,
                iconSize: [50, 50],
                iconAnchor: [25, 25]
            });

            // keyboard: false prevents Leaflet's default tab wrapper, letting us control focus
            const marker = L.marker(loc.coords, { icon: icon, keyboard: false });
            markers[loc.name] = marker;

            const activate = (e) => {
                // Determine if triggered by keyboard
                const isKeyboard = e.type === 'keydown' || (e.originalEvent && e.originalEvent.type === 'keydown');

                // Update visual state of all markers
                Object.values(markers).forEach(m => {
                    const el = m.getElement();
                    if(el) el.classList.remove('active-marker');
                });

                const currentEl = marker.getElement();
                if(currentEl) currentEl.classList.add('active-marker');

                // Fly to location
                const isMobile = window.innerWidth < 768;

                // Calculate target center to avoid panel occlusion
                // On mobile: Panel is at bottom, so we shift map center down (positive Y)
                // to make the marker appear higher up in the viewport.
                const targetZoom = 16;
                const targetPoint = map.project(loc.coords, targetZoom);
                const offset = isMobile ? L.point(0, 150) : L.point(0, 0);
                const targetCenter = map.unproject(targetPoint.add(offset), targetZoom);

                map.flyTo(targetCenter, targetZoom, {
                    animate: true,
                    duration: 1.2,
                    easeLinearity: 0.2
                });

                showPanel(loc, isKeyboard);

                // Stop propagation
                const event = e.originalEvent || e;
                if(event && event.stopPropagation) event.stopPropagation();
            };

            marker.on('click', activate);

            // Add listener for Keyboard Enter/Space
            marker.on('add', () => {
                const el = marker.getElement();
                if (activeMarkerName === loc.name && el) {
                    el.classList.add('active-marker');
                }

                const wrapper = el ? el.querySelector('.marker-wrapper') : null;
                if(wrapper) {
                    wrapper.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            activate(e);
                        }
                    });
                }
            });

            marker.addTo(map);
        });

        // --- PANEL FUNCTIONS ---
        function showPanel(data, shouldFocus) {
            panelTitle.innerText = data.name;
            panelBody.innerText = data.text;

            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
            activeMarkerName = data.name;

            if (shouldFocus) {
                // Wait for transition
                setTimeout(() => closeBtn.focus(), 150);
            }
        }

        function hidePanel() {
            if (!panel.classList.contains('active')) return;

            const prevActive = activeMarkerName;
            panel.classList.remove('active');
            panel.setAttribute('aria-hidden', 'true');
            activeMarkerName = null;

            // Clear marker active states
            Object.values(markers).forEach(m => {
                const el = m.getElement();
                if(el) el.classList.remove('active-marker');
            });

            // Return focus to the marker that opened it
            if (prevActive && markers[prevActive]) {
                const el = markers[prevActive].getElement();
                const wrapper = el ? el.querySelector('.marker-wrapper') : null;
                if (wrapper) wrapper.focus();
            }
        }

        // --- EVENTS ---
        closeBtn.addEventListener('click', hidePanel);

        // Clicking map background closes panel
        map.on('click', hidePanel);

        // Escape key closes panel
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hidePanel();
        });

    </script>
</body>
</html>
