<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Mamallapuram | Coastal Serenity</title>
    <meta name="description" content="An immersive journey through the stone and silence of Mamallapuram.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        :root {
            /* Palette: Coastal Serenity Refined */
            --c-bg: #F0F4F8;
            --c-surface: #ffffff;
            --c-text-main: #2D3748;
            --c-text-light: #718096;

            --c-accent-warm: #DD6B20; /* Burnt Orange */
            --c-accent-warm-soft: #FBD38D;
            --c-accent-cool: #319795; /* Teal */
            --c-accent-cool-soft: #B2F5EA;

            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            --glass-blur: blur(20px);

            /* Typography */
            --f-head: 'Playfair Display', serif;
            --f-body: 'Lato', sans-serif;

            /* Animation */
            --ease-out-quart: cubic-bezier(0.165, 0.84, 0.44, 1);
            --ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);
            --ease-elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);

            --anim-entry-dur: 1.2s;
            --anim-delay-base: 0.2s;
        }

        /* Reset & Base */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            background-color: var(--c-bg);
            font-family: var(--f-body);
            color: var(--c-text-main);
            overflow: hidden;
            font-size: 16px;
        }

        /* Map Container & Effects */
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0;
            animation: fadeIn 1.5s var(--ease-out-quart) forwards;
        }

        /* Vignette Overlay */
        .vignette {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            background: radial-gradient(circle at center, transparent 0%, rgba(240, 244, 248, 0.0) 60%, rgba(240, 244, 248, 0.3) 100%);
            mix-blend-mode: multiply;
        }

        /* Leaflet Tile Styling */
        .leaflet-tile-pane {
            /* Dreamy, desaturated, slightly teal-tinted */
            filter: grayscale(100%) sepia(15%) hue-rotate(170deg) brightness(105%) contrast(90%);
            transition: filter 1s ease;
        }

        /* UI Layer */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 3rem;
        }

        /* Glass Component */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 24px;
        }

        /* Header */
        header {
            pointer-events: auto;
            align-self: flex-start;
            padding: 2rem 3rem;
            opacity: 0;
            transform: translateY(-30px);
            animation: slideDownFade 1s var(--ease-out-quart) var(--anim-delay-base) forwards;
            max-width: 600px;
        }

        h1 {
            font-family: var(--f-head);
            font-weight: 700;
            font-size: 3rem;
            color: var(--c-text-main);
            line-height: 1.1;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--c-text-main) 0%, #4A5568 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            display: flex;
            align-items: center;
            font-family: var(--f-body);
            font-weight: 400;
            font-size: 0.9rem;
            color: var(--c-accent-cool);
            letter-spacing: 0.2em;
            text-transform: uppercase;
        }

        .subtitle::before {
            content: '';
            display: block;
            width: 2rem;
            height: 1px;
            background: var(--c-accent-cool);
            margin-right: 1rem;
            opacity: 0.6;
        }

        /* Info Panel */
        .info-panel {
            align-self: flex-end; /* Changed to flex-end for better desktop layout usually, but staying left aligned */
            align-self: flex-start;
            width: 420px;
            max-width: 90vw;
            min-height: 200px;
            padding: 2.5rem;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            transition: all 0.6s var(--ease-out-quart);
            pointer-events: none; /* Hidden by default effectively */
            visibility: hidden;
            position: relative;
        }

        .info-panel.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
            visibility: visible;
        }

        .panel-content {
            position: relative;
            z-index: 2;
        }

        .info-title {
            font-family: var(--f-head);
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            color: var(--c-text-main);
            line-height: 1.1;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease 0.1s;
        }

        .info-body {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--c-text-light);
            font-weight: 300;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease 0.2s;
        }

        .info-panel.active .info-title,
        .info-panel.active .info-body {
            opacity: 1;
            transform: translateY(0);
        }

        /* Close Button */
        .panel-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 36px;
            height: 36px;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s ease;
            border-radius: 50%;
            background: rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid transparent;
            outline: none;
        }
        .panel-close:hover {
            opacity: 1;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transform: rotate(90deg);
        }
        .panel-close:focus-visible {
            box-shadow: 0 0 0 2px var(--c-accent-cool);
            border-color: var(--c-accent-cool);
        }
        .panel-close svg {
            width: 16px;
            height: 16px;
            fill: var(--c-text-main);
        }

        /* Custom Markers */
        .custom-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            will-change: transform;
        }

        .marker-container {
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s var(--ease-elastic);
        }

        .marker-container:hover {
            transform: scale(1.15);
            z-index: 1000;
        }

        .pin {
            width: 16px;
            height: 16px;
            background: var(--c-surface);
            border: 4px solid var(--c-accent-warm);
            border-radius: 50%;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(221, 107, 32, 0.4);
            transition: all 0.3s ease;
        }

        .marker-container:focus-visible .pin {
            outline: none;
            box-shadow: 0 0 0 4px rgba(221, 107, 32, 0.3);
            border-color: var(--c-text-main);
        }

        .marker-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid var(--c-accent-warm);
            opacity: 0;
            z-index: 1;
            animation: pulse-ring 3s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        .marker-pulse:nth-child(2) {
            animation-delay: 0.8s;
        }

        /* Marker Active State */
        .custom-marker.active-state .pin {
            background: var(--c-accent-warm);
            border-color: var(--c-surface);
            transform: scale(1.2);
        }
        .custom-marker.active-state .marker-pulse {
            animation: none;
            border-color: var(--c-accent-cool);
            background: rgba(49, 151, 149, 0.1);
            transform: scale(1.5);
            opacity: 1;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.5); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: scale(1.8); opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDownFade {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Zoom Control Customization */
        .leaflet-control-zoom {
            border: none !important;
            margin-bottom: 3rem !important;
            margin-right: 3rem !important;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .leaflet-control-zoom a {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-blur) !important;
            -webkit-backdrop-filter: var(--glass-blur) !important;
            color: var(--c-text-main) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 50% !important; /* Circle buttons */
            width: 44px !important;
            height: 44px !important;
            line-height: 44px !important;
            box-shadow: var(--glass-shadow) !important;
            font-weight: 300 !important;
            font-size: 1.5rem !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        .leaflet-control-zoom a:hover {
            background: #fff !important;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
            color: var(--c-accent-cool) !important;
        }
        .leaflet-control-zoom a:focus-visible {
            outline: 2px solid var(--c-accent-cool) !important;
            outline-offset: 2px;
        }

        /* Attribution */
        .leaflet-control-attribution {
            background: rgba(255,255,255,0.4) !important;
            backdrop-filter: blur(4px);
            padding: 4px 8px !important;
            border-radius: 4px;
            font-family: var(--f-body);
            color: var(--c-text-light) !important;
            font-size: 0.7rem !important;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }
        .leaflet-control-attribution a {
            color: var(--c-text-main) !important;
            text-decoration: none;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .ui-layer { padding: 1.5rem; }

            header {
                padding: 1.5rem;
                width: 100%;
                max-width: none;
            }
            h1 { font-size: 2rem; }

            .info-panel {
                width: calc(100% - 3rem);
                bottom: 1.5rem;
                padding: 1.5rem;
                position: absolute; /* Force it to bottom */
                bottom: 1.5rem;
                left: 1.5rem;
            }

            .info-title { font-size: 1.6rem; }
            .info-body { font-size: 1rem; }

            /* On Mobile, hide zoom controls to save space */
            .leaflet-control-zoom { display: none; }
        }
    </style>
</head>
<body>
    <div id="map-container">
        <div id="map" style="height: 100%; width: 100%;" role="application" aria-label="Interactive Map of Mamallapuram"></div>
        <div class="vignette"></div>
    </div>

    <div class="ui-layer">
        <header class="glass">
            <h1>Mamallapuram</h1>
            <span class="subtitle">Stone &bull; Salt &bull; Silence</span>
        </header>

        <aside id="panel" class="info-panel glass" aria-labelledby="panel-title" aria-hidden="true">
            <button class="panel-close" id="panel-close" aria-label="Close details">
                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div class="panel-content">
                <div class="info-title" id="panel-title"></div>
                <div class="info-body" id="panel-body"></div>
            </div>
        </aside>
    </div>

    <script>
        // Data
        const locations = [
            {
                name: "Shore Temple",
                coords: [12.6111, 80.1973],
                text: "Standing defiant against the Bay of Bengal since the 8th century, this granite structural temple captures the first light of dawn. It is the last survivor of the legendary Seven Pagodas."
            },
            {
                name: "Descent of the Ganges",
                coords: [12.6163, 80.1918],
                text: "A masterpiece of narrative art carved into two giant boulders. It depicts the celestial river Ganges descending from the heavens, witnessed by gods, animals, and sages in intricate detail."
            },
            {
                name: "Krishnaâ€™s Butter Ball",
                coords: [12.6175, 80.1923],
                text: "Vaanirai Kal (Stone of Sky God) is a 250-ton rock perched precariously on a slope. Defying gravity and attempts to move it, it remains a playful enigma of nature."
            },
            {
                name: "Pancha Rathas",
                coords: [12.6083, 80.1894],
                text: "Five monolithic pyramidal structures named after the Pandavas. Carved from a single large rock, these 'chariots' showcase the evolution of Dravidian architecture."
            },
            {
                name: "Mahabalipuram Lighthouse",
                coords: [12.6144, 80.1947],
                text: "A beacon guiding sailors since 1904. Climb the spiral stairs for a panoramic view of the ancient town, the shimmering ocean, and the spread of casuarina trees."
            }
        ];

        // Map Initialization
        const map = L.map('map', {
            center: [12.6140, 80.1935],
            zoom: 15,
            minZoom: 14,
            maxZoom: 18,
            zoomControl: false,
            attributionControl: true,
            scrollWheelZoom: 'center' /* Better UX */
        });

        // Controls
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // Tiles
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // UI References
        const panel = document.getElementById('panel');
        const panelTitle = document.getElementById('panel-title');
        const panelBody = document.getElementById('panel-body');
        const panelCloseBtn = document.getElementById('panel-close');

        let activeMarkerName = null;
        const markers = {};

        // Helper: Escape HTML
        const escapeHtml = (str) => str.replace(/[&<>"']/g,
            tag => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[tag]));

        // Marker Logic
        locations.forEach(loc => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div class="marker-container" role="button" tabindex="0" aria-label="View details for ${escapeHtml(loc.name)}">
                        <div class="marker-pulse"></div>
                        <div class="marker-pulse"></div>
                        <div class="pin"></div>
                    </div>
                `,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });

            const marker = L.marker(loc.coords, { icon: icon });
            markers[loc.name] = marker;

            // Interaction Handler
            const activate = (e) => {
                const isKeyboard = e.type === 'keydown' || (e.originalEvent && e.originalEvent.type === 'keydown');

                // Visual update
                Object.values(markers).forEach(m => {
                    m.getElement().classList.remove('active-state');
                });
                marker.getElement().classList.add('active-state');

                // Map Fly
                const isMobile = window.innerWidth < 768;
                // Shift center slightly to accommodate panel
                const offset = isMobile ? [0, -100] : [150, 0];
                const targetZoom = Math.max(map.getZoom(), 16);

                // Calculate offset center
                const targetPoint = map.project(loc.coords, targetZoom).subtract(offset);
                const targetLatLng = map.unproject(targetPoint, targetZoom);

                map.flyTo(targetLatLng, targetZoom, {
                    animate: true,
                    duration: 1.5,
                    easeLinearity: 0.1
                });

                showPanel(loc, isKeyboard);
                L.DomEvent.stopPropagation(e);
            };

            marker.on('click', activate);

            // Accessibility: Keyboard support attached to DOM element once added
            marker.on('add', () => {
                const el = marker.getElement();
                const container = el.querySelector('.marker-container');
                if (container) {
                    container.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            activate(e);
                        }
                    });
                }
            });

            marker.addTo(map);
        });

        // Panel Logic
        function showPanel(data, isKeyboard) {
            panelTitle.innerText = data.name;
            panelBody.innerText = data.text;

            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
            activeMarkerName = data.name;

            if (isKeyboard) {
                setTimeout(() => panelCloseBtn.focus(), 100);
            }
        }

        function hidePanel() {
            if (!panel.classList.contains('active')) return;

            const prevMarkerName = activeMarkerName;

            panel.classList.remove('active');
            panel.setAttribute('aria-hidden', 'true');
            activeMarkerName = null;

            // Reset marker visuals
            Object.values(markers).forEach(m => {
                if(m.getElement()) m.getElement().classList.remove('active-state');
            });

            // Return focus
            if (prevMarkerName && markers[prevMarkerName]) {
                const el = markers[prevMarkerName].getElement();
                const container = el ? el.querySelector('.marker-container') : null;
                if (container) container.focus();
            }
        }

        // Event Listeners
        panelCloseBtn.addEventListener('click', hidePanel);
        map.on('click', hidePanel);

        // Map Click Accessibility (ESC to clear selection)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hidePanel();
        });

    </script>
</body>
</html>
