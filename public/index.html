<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>Mamallapuram | Coastal Serenity</title>
    <meta name="description" content="An immersive journey through the stone and silence of Mamallapuram.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /*
         * DESIGN SYSTEM: Coastal Serenity
         * Theme: Ethereal, Sophisticated, Organic
         */
        :root {
            /* Palette - Refined Pastel */
            --c-bg: #F0F4F8; /* Requested Background */
            --c-surface: #FFFFFF;

            /* Text Colors */
            --c-text-primary: #1A202C;
            --c-text-secondary: #4A5568;
            --c-text-accent: #319795; /* Cool Accent Darker */

            /* Accents from Palette */
            --c-accent-warm: #F6AD55; /* Warm Accent 1 */
            --c-accent-warm-dark: #DD6B20; /* Warm Accent 2 */
            --c-accent-cool: #38B2AC; /* Cool Accent 1 */
            --c-accent-cool-dark: #319795; /* Cool Accent 2 */

            /* Glassmorphism Variables - Premium Frosted */
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-highlight: rgba(255, 255, 255, 0.8);
            --glass-shadow:
                0 4px 6px -1px rgba(0, 0, 0, 0.02),
                0 10px 15px -3px rgba(49, 151, 149, 0.05), /* Subtle teal shadow tint */
                inset 0 0 20px rgba(255, 255, 255, 0.5);
            --glass-blur: blur(20px);

            /* Typography */
            --f-display: 'Playfair Display', serif;
            --f-body: 'Lato', sans-serif;

            /* Transitions */
            --ease-elastic: cubic-bezier(0.68, -0.6, 0.32, 1.6);
            --ease-smooth: cubic-bezier(0.2, 0.0, 0.2, 1);
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);

            /* Spacing */
            --space-unit: clamp(1rem, 2.5vw, 2.5rem);
        }

        /*
         * RESET & BASE
         */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--c-bg);
            font-family: var(--f-body);
            color: var(--c-text-primary);
            font-size: 16px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /*
         * LOADING CURTAIN
         */
        .loading-curtain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--c-bg);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 1.2s var(--ease-smooth), opacity 0.8s ease;
            transform-origin: top;
        }

        .loading-curtain.hidden {
            transform: translateY(-100%);
            pointer-events: none;
        }

        .loading-title {
            font-family: var(--f-display);
            font-size: 3rem;
            color: var(--c-text-primary);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInTitle 1.5s var(--ease-smooth) forwards;
        }

        @keyframes fadeInTitle {
            to { opacity: 1; transform: translateY(0); }
        }

        /*
         * MAP CONTAINER & STYLING
         */
        #map-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0;
            animation: revealMap 2s var(--ease-smooth) 0.5s forwards;
        }

        /* SVG Noise Overlay for Texture */
        .texture-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0.05;
            mix-blend-mode: overlay;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Vignette for Cinematic Focus */
        .vignette-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 4;
            background: radial-gradient(circle, transparent 60%, rgba(240, 244, 248, 0.4) 100%);
        }

        /* Map Tiles Custom Filter */
        /* Adjusted for the new palette - warmer and softer */
        .leaflet-tile-pane {
            filter: grayscale(0.8) brightness(1.02) contrast(0.9) sepia(0.15) hue-rotate(170deg) saturate(0.8);
            transition: filter 0.8s ease;
        }

        /*
         * UI LAYOUT
         */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: grid;
            grid-template-rows: auto 1fr auto;
            grid-template-columns: 1fr;
            padding: var(--space-unit);
        }

        /*
         * COMPONENTS
         */

        /* Glassmorphism Mixin Class */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-highlight); /* Highlight for depth */
            border-radius: 24px;
            box-shadow: var(--glass-shadow);
        }

        /* Header */
        .header-container {
            grid-row: 1;
            justify-self: start;
            pointer-events: auto;
            max-width: 500px;
            opacity: 0;
            /* Animation applied via JS for staggering */
        }

        .brand-card {
            padding: 2.5rem 3rem;
            position: relative;
            overflow: hidden;
            animation: float 8s ease-in-out infinite;
        }

        /* Decorative sheen on card */
        .brand-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-20deg);
            animation: sheen 8s infinite 2s;
            pointer-events: none;
        }

        h1 {
            font-family: var(--f-display);
            font-weight: 700;
            font-size: clamp(2.2rem, 5vw, 3.5rem);
            line-height: 1.05;
            letter-spacing: -0.03em;
            color: var(--c-text-primary);
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, var(--c-text-primary) 0%, var(--c-text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-family: var(--f-body);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: var(--c-accent-cool-dark);
            display: flex;
            align-items: center;
        }

        .subtitle::before {
            content: '';
            display: block;
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, var(--c-accent-warm), var(--c-accent-cool));
            margin-right: 15px;
            border-radius: 2px;
        }

        /* Info Panel */
        .panel-container {
            grid-row: 2 / -1;
            align-self: end;
            justify-self: start;
            width: 100%;
            max-width: 460px;
            pointer-events: none;
        }

        .info-card {
            padding: 3rem;
            pointer-events: auto;
            position: relative;
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            visibility: hidden;
            transition: all 0.6s var(--ease-spring);
            will-change: transform, opacity;
        }

        .info-card.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            visibility: visible;
        }

        .info-title {
            font-family: var(--f-display);
            font-size: 2.25rem;
            font-weight: 600;
            color: var(--c-text-primary);
            margin-bottom: 1.25rem;
            line-height: 1.1;
        }

        .info-body {
            font-size: 1.1rem;
            line-height: 1.7;
            color: var(--c-text-secondary);
            font-weight: 300;
        }

        .close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--c-text-primary);
            backdrop-filter: blur(4px);
        }

        .close-btn:hover {
            background: #fff;
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .close-btn:focus-visible {
            outline: 2px solid var(--c-accent-cool);
            outline-offset: 2px;
        }

        /*
         * CUSTOM MARKERS
         */
        .custom-marker {
            background: transparent;
        }

        @keyframes fadeInMarker {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }

        .marker-wrapper {
            position: relative;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.4s var(--ease-elastic);
            border-radius: 50%;
            opacity: 0; /* Hidden initially for stagger */
            will-change: transform;
            animation: fadeInMarker 0.8s var(--ease-elastic) forwards;
        }

        .marker-wrapper:focus-visible {
            outline: none;
        }

        /* Focus ring separate to not mess up layout */
        .marker-wrapper:focus-visible .marker-dot {
             box-shadow: 0 0 0 4px var(--c-accent-cool);
        }

        .marker-wrapper:hover {
            transform: scale(1.15) translateY(-5px);
            z-index: 100;
        }

        /* Tooltip style */
        .marker-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(255, 255, 255, 0.9);
            color: var(--c-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s var(--ease-smooth);
            pointer-events: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            font-family: var(--f-body);
            backdrop-filter: blur(4px);
        }

        .marker-wrapper:hover .marker-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-8px);
        }

        .marker-dot {
            width: 16px;
            height: 16px;
            background-color: var(--c-surface);
            border: 4px solid var(--c-accent-warm);
            border-radius: 50%;
            position: relative;
            z-index: 2;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .marker-ripple {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--c-accent-warm);
            border-radius: 50%;
            opacity: 0;
            animation: ripple 3s infinite;
            box-sizing: border-box;
            pointer-events: none;
        }

        .marker-ripple:nth-child(2) {
            animation-delay: 1s;
        }

        /* Active Marker State */
        .custom-marker.active-marker .marker-dot {
            background-color: var(--c-accent-warm);
            border-color: var(--c-surface);
            transform: scale(1.4);
            box-shadow: 0 0 0 4px rgba(246, 173, 85, 0.3); /* Glow */
        }

        .custom-marker.active-marker .marker-ripple {
            border-color: var(--c-accent-cool);
            animation-duration: 2s;
        }

        @keyframes ripple {
            0% { transform: scale(0.3); opacity: 0; }
            50% { opacity: 0.4; }
            100% { transform: scale(1.4); opacity: 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        @keyframes sheen {
            0% { left: -100%; }
            20% { left: 200%; }
            100% { left: 200%; }
        }

        @keyframes revealMap {
            from { opacity: 0; transform: scale(1.1); filter: blur(10px); }
            to { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stagger Classes */
        .stagger-enter {
            opacity: 0;
            animation: slideUpFade 1s var(--ease-smooth) forwards;
        }

        /*
         * LEAFLET OVERRIDES
         */
        .leaflet-control-zoom {
            border: none !important;
            margin: var(--space-unit) !important;
            box-shadow: var(--glass-shadow) !important;
        }

        .leaflet-control-zoom a {
            background: rgba(255, 255, 255, 0.85) !important;
            color: var(--c-text-primary) !important;
            backdrop-filter: var(--glass-blur);
            border-bottom: 1px solid rgba(0,0,0,0.05) !important;
            width: 44px !important;
            height: 44px !important;
            line-height: 44px !important;
            font-size: 1.4rem !important;
            transition: all 0.2s;
        }

        .leaflet-control-zoom a:first-child { border-top-left-radius: 12px !important; border-top-right-radius: 12px !important; }
        .leaflet-control-zoom a:last-child { border-bottom-left-radius: 12px !important; border-bottom-right-radius: 12px !important; }

        .leaflet-control-zoom a:hover {
            background: #fff !important;
            color: var(--c-text-accent) !important;
            transform: scale(1.05);
        }

        .leaflet-control-attribution {
            background: rgba(255,255,255,0.7) !important;
            padding: 4px 10px !important;
            border-radius: 20px;
            font-size: 11px !important;
            color: var(--c-text-secondary) !important;
            backdrop-filter: blur(4px);
            margin-right: 10px !important;
            margin-bottom: 10px !important;
        }

        /*
         * RESPONSIVE
         */
        @media (max-width: 768px) {
            .ui-layer {
                grid-template-rows: auto 1fr auto;
                padding: 1.25rem;
            }

            .header-container {
                max-width: 100%;
                width: 100%;
            }

            .brand-card {
                padding: 1.75rem 2rem;
                background: rgba(255,255,255,0.75);
                animation: none; /* Disable float on mobile to save battery/reduce distraction */
            }

            h1 { margin-bottom: 0.5rem; }

            .panel-container {
                position: absolute;
                bottom: 1rem;
                left: 1rem;
                right: 1rem;
                width: auto;
                max-width: none;
                z-index: 100;
            }

            .info-card {
                padding: 2rem 2rem;
                max-height: 55vh;
                overflow-y: auto;
                /* Handle bar for bottom sheet indication */
                padding-top: 2.5rem;
            }

            .info-card::before {
                content: '';
                position: absolute;
                top: 12px;
                left: 50%;
                transform: translateX(-50%);
                width: 40px;
                height: 4px;
                background-color: rgba(0,0,0,0.1);
                border-radius: 2px;
            }

            .leaflet-control-zoom { display: none; }
        }
    </style>
</head>
<body>

    <!-- Loading Curtain -->
    <div class="loading-curtain" id="curtain">
        <div class="loading-title">Coastal Serenity</div>
    </div>

    <!-- Texture Overlay for Grain Effect -->
    <div class="texture-overlay"></div>
    <div class="vignette-overlay"></div>

    <div id="map-container">
        <div id="map" style="height: 100%; width: 100%;" role="application" aria-label="Interactive Map of Mamallapuram"></div>
    </div>

    <div class="ui-layer">
        <header class="header-container stagger-enter" style="animation-delay: 1.2s;">
            <div class="brand-card glass-panel">
                <h1>Mamallapuram</h1>
                <div class="subtitle">Stone &bull; Salt &bull; Silence</div>
            </div>
        </header>

        <div class="panel-container">
            <aside id="info-panel" class="info-card glass-panel" aria-hidden="true">
                <button class="close-btn" id="close-panel" aria-label="Close details">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
                <h2 class="info-title" id="info-title">Title Here</h2>
                <div class="info-body" id="info-body">
                    Description goes here.
                </div>
            </aside>
        </div>
    </div>

    <script>
        // --- DATA ---
        const locations = [
            {
                name: "Shore Temple",
                coords: [12.6111, 80.1973],
                text: "Standing defiant against the Bay of Bengal since the 8th century, this granite structural temple captures the first light of dawn. It is the last survivor of the legendary Seven Pagodas."
            },
            {
                name: "Descent of the Ganges",
                coords: [12.6163, 80.1918],
                text: "A masterpiece of narrative art carved into two giant boulders. It depicts the celestial river Ganges descending from the heavens, witnessed by gods, animals, and sages in intricate detail."
            },
            {
                name: "Krishnaâ€™s Butter Ball",
                coords: [12.6175, 80.1923],
                text: "Vaanirai Kal (Stone of Sky God) is a 250-ton rock perched precariously on a slope. Defying gravity and attempts to move it, it remains a playful enigma of nature."
            },
            {
                name: "Pancha Rathas",
                coords: [12.6083, 80.1894],
                text: "Five monolithic pyramidal structures named after the Pandavas. Carved from a single large rock, these 'chariots' showcase the evolution of Dravidian architecture."
            },
            {
                name: "Mahabalipuram Lighthouse",
                coords: [12.6144, 80.1947],
                text: "A beacon guiding sailors since 1904. Climb the spiral stairs for a panoramic view of the ancient town, the shimmering ocean, and the spread of casuarina trees."
            }
        ];

        // --- INIT MAP ---
        const map = L.map('map', {
            center: [12.6140, 80.1935],
            zoom: 15,
            minZoom: 14,
            maxZoom: 18,
            zoomControl: false,
            attributionControl: true,
            scrollWheelZoom: 'center'
        });

        // Add Zoom Control at bottom right
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // Tile Layer - CartoDB Light
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // --- UI REFS ---
        const panel = document.getElementById('info-panel');
        const panelTitle = document.getElementById('info-title');
        const panelBody = document.getElementById('info-body');
        const closeBtn = document.getElementById('close-panel');
        const curtain = document.getElementById('curtain');

        let activeMarkerName = null;
        const markers = {};

        // --- ENTRANCE ANIMATION ---
        window.addEventListener('load', () => {
            setTimeout(() => {
                curtain.classList.add('hidden');
            }, 1000); // 1s reading time for title
        });

        // --- MARKER LOGIC ---
        locations.forEach((loc, index) => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `
                    <div class="marker-wrapper" role="button" tabindex="0" aria-label="Explore ${loc.name}" style="animation-delay: ${1.5 + (index * 0.1)}s">
                        <div class="marker-tooltip">${loc.name}</div>
                        <div class="marker-ripple"></div>
                        <div class="marker-ripple"></div>
                        <div class="marker-dot"></div>
                    </div>
                `,
                iconSize: [60, 60],
                iconAnchor: [30, 30]
            });

            // keyboard: false prevents Leaflet's default tab wrapper, letting us control focus
            const marker = L.marker(loc.coords, { icon: icon, keyboard: false });
            markers[loc.name] = marker;

            const activate = (e) => {
                // Determine if triggered by keyboard
                const isKeyboard = e.type === 'keydown' || (e.originalEvent && e.originalEvent.type === 'keydown');

                // Update visual state of all markers
                Object.values(markers).forEach(m => {
                    const el = m.getElement();
                    if(el) el.classList.remove('active-marker');
                });

                const currentEl = marker.getElement();
                if(currentEl) currentEl.classList.add('active-marker');

                // Fly to location
                const isMobile = window.innerWidth < 768;

                // Calculate target center to avoid panel occlusion
                // On mobile: Panel is at bottom, so we shift map center down (positive Y)
                const targetZoom = 16;
                const targetPoint = map.project(loc.coords, targetZoom);
                const offset = isMobile ? L.point(0, 200) : L.point(0, 0); // Increased offset for better visibility
                const targetCenter = map.unproject(targetPoint.add(offset), targetZoom);

                map.flyTo(targetCenter, targetZoom, {
                    animate: true,
                    duration: 1.5,
                    easeLinearity: 0.25
                });

                showPanel(loc, isKeyboard);

                // Stop propagation
                const event = e.originalEvent || e;
                if(event && event.stopPropagation) event.stopPropagation();
            };

            marker.on('click', activate);

            // Add listener for Keyboard Enter/Space
            marker.on('add', () => {
                const el = marker.getElement();
                if (activeMarkerName === loc.name && el) {
                    el.classList.add('active-marker');
                }

                const wrapper = el ? el.querySelector('.marker-wrapper') : null;
                if(wrapper && !wrapper.dataset.hasListener) {
                    wrapper.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            activate(e);
                        }
                    });
                    wrapper.dataset.hasListener = 'true';
                }
            });

            marker.addTo(map);
        });

        // --- PANEL FUNCTIONS ---
        function showPanel(data, shouldFocus) {
            panelTitle.innerText = data.name;
            panelBody.innerText = data.text;

            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
            activeMarkerName = data.name;

            if (shouldFocus) {
                // Wait for transition to complete to ensure visibility
                setTimeout(() => closeBtn.focus(), 600);
            }
        }

        function hidePanel() {
            if (!panel.classList.contains('active')) return;

            const prevActive = activeMarkerName;
            panel.classList.remove('active');
            panel.setAttribute('aria-hidden', 'true');
            activeMarkerName = null;

            // Clear marker active states
            Object.values(markers).forEach(m => {
                const el = m.getElement();
                if(el) el.classList.remove('active-marker');
            });

            // Return focus to the marker that opened it
            if (prevActive && markers[prevActive]) {
                const el = markers[prevActive].getElement();
                const wrapper = el ? el.querySelector('.marker-wrapper') : null;
                if (wrapper) wrapper.focus();
            }
        }

        // --- EVENTS ---
        closeBtn.addEventListener('click', hidePanel);

        // Clicking map background closes panel
        map.on('click', hidePanel);

        // Escape key closes panel
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hidePanel();
        });

    </script>
</body>
</html>
