<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mamallapuram</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        :root {
            /* Palette: Derived from Granite, Sand, and Bay Water */
            --c-bg: #F4F3EF;          /* Mist Gray / Warm Stone */
            --c-text: #3A3935;        /* Volcanic Stone (Softened) */
            --c-subtle: #8C8883;      /* Weathered Rock */
            --c-accent: #6B7C85;      /* Lagoon Blue (Muted) */
            --c-marker: #5B5A56;      /* Deep Stone */
            --c-panel: #FCFBF9;       /* Light Sand */

            --f-sys: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

            --ease-out: cubic-bezier(0.4, 0.0, 0.2, 1);
            --dur-entry: 420ms;
            --dur-interact: 240ms;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body, html {
            height: 100%;
            width: 100%;
            background-color: var(--c-bg);
            font-family: var(--f-sys);
            color: var(--c-text);
            overflow: hidden;
            font-size: 16px;
        }

        /* Map Container */
        #map {
            height: 100%;
            width: 100%;
            opacity: 0;
            background: var(--c-bg);
            transition: opacity var(--dur-entry) var(--ease-out);
            z-index: 1;
        }

        /* Tile Filtering */
        .leaflet-tile-pane {
            filter: grayscale(100%) sepia(10%) contrast(90%) brightness(105%);
            opacity: 0.85;
        }

        /* UI Layer */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Title */
        h1 {
            font-weight: 500;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
            color: var(--c-text);
            opacity: 0;
            transform: translateY(6px);
            animation: fadeUp var(--dur-entry) var(--ease-out) 100ms forwards;
            pointer-events: auto;
            max-width: 200px;
            line-height: 1.4;
        }

        .subtitle {
            display: block;
            font-weight: 400;
            font-size: 0.85rem;
            color: var(--c-subtle);
            margin-top: 0.4rem;
        }

        /* Marker Styles */
        .custom-marker {
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform var(--dur-interact) var(--ease-out);
        }

        .marker-dot {
            width: 10px;
            height: 10px;
            background-color: var(--c-marker);
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(91, 90, 86, 0.15);
            transition: transform var(--dur-interact) var(--ease-out), opacity var(--dur-interact) var(--ease-out);
            position: relative;
        }

        .marker-dot::after {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border-radius: 50%;
            background: rgba(91, 90, 86, 0.05);
            opacity: 0;
            transform: scale(0.8);
            transition: all var(--dur-interact) var(--ease-out);
        }

        /* Idle Pulse */
        @keyframes subtlePulse {
            0% { opacity: 0.9; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.96); }
            100% { opacity: 0.9; transform: scale(1); }
        }

        .marker-dot.idle {
            animation: subtlePulse 5s ease-in-out infinite;
        }

        .custom-marker:hover .marker-dot {
            transform: scale(1.1);
            background-color: var(--c-text);
        }

        .custom-marker:hover .marker-dot::after {
            opacity: 1;
            transform: scale(1);
        }

        /* Info Panel */
        .info-panel {
            position: absolute;
            bottom: 3rem;
            left: 2rem;
            max-width: 320px;
            background: var(--c-panel);
            padding: 1.8rem;
            border-radius: 2px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            opacity: 0;
            transform: translateY(10px);
            transition: all var(--dur-entry) var(--ease-out);
            pointer-events: auto;
            border-left: 1px solid rgba(0,0,0,0.05);
        }

        .info-panel.active {
            opacity: 1;
            transform: translateY(0);
        }

        .info-title {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 0.8rem;
            color: var(--c-text);
            letter-spacing: -0.01em;
        }

        .info-body {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--c-accent); /* Muted blue/grey for text */
            font-weight: 400;
        }

        /* Animations */
        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Controls */
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: none !important;
            opacity: 0;
            transition: opacity var(--dur-interact) var(--ease-out);
        }

        .leaflet-control-zoom-in, .leaflet-control-zoom-out {
            background-color: var(--c-bg) !important;
            color: var(--c-marker) !important;
            font-weight: 300 !important;
            font-size: 1.2rem !important;
            border-radius: 2px !important;
            margin-bottom: 4px !important;
            border: 1px solid rgba(0,0,0,0.05) !important;
        }

        .leaflet-bar a:hover {
            background-color: #FFF !important;
            color: #000 !important;
        }

        #map:active .leaflet-control-zoom {
            opacity: 1;
        }

        .leaflet-container {
            background: var(--c-bg) !important;
            font-family: var(--f-sys) !important;
        }

        /* Attribution */
        .leaflet-control-attribution {
            background: transparent !important;
            color: var(--c-subtle) !important;
            font-size: 0.65rem !important;
            opacity: 0.4;
        }
        .leaflet-control-attribution a {
            color: var(--c-subtle) !important;
            text-decoration: none;
        }

        /* Intro Overlay */
        #intro {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 900;
            transition: opacity 800ms ease-out;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="ui-layer">
        <h1>
            Mamallapuram
            <span class="subtitle">Stone. Salt. Silence.</span>
        </h1>

        <!-- Info Panel Container -->
        <div id="panel" class="info-panel">
            <div class="info-title" id="panel-title"></div>
            <div class="info-body" id="panel-body"></div>
        </div>
    </div>

    <script>
        // Data: Curated locations
        const locations = [
            {
                name: "Shore Temple",
                coords: [12.6111, 80.1973],
                text: "Granite against the tide. The last of seven pagodas, standing where the ocean ends."
            },
            {
                name: "Descent of the Ganges",
                coords: [12.6163, 80.1918],
                text: "A canvas of living rock. Elephants and gods frozen in a moment of arrival."
            },
            {
                name: "Krishnaâ€™s Butter Ball",
                coords: [12.6175, 80.1923],
                text: "Improbable balance. A monolith resting on a slope, defying the urge to roll."
            },
            {
                name: "Pancha Rathas",
                coords: [12.6083, 80.1894],
                text: "Monoliths carved from single stones. Chariots that never moved, waiting in the sand."
            },
            {
                name: "Mahabalipuram Lighthouse",
                coords: [12.6144, 80.1947],
                text: "A silent watch over the Coromandel coast. Light cutting through the salt air."
            }
        ];

        // Map Config
        const config = {
            center: [12.6140, 80.1935],
            zoom: 15,
            minZoom: 14,
            maxZoom: 17,
            zoomDelta: 0.5,
            zoomSnap: 0.5,
            wheelPxPerZoomLevel: 120
        };

        // Initialize Map
        const map = L.map('map', {
            center: config.center,
            zoom: config.zoom,
            zoomControl: false,
            attributionControl: true,
            zoomAnimation: true,
            fadeAnimation: true,
            markerZoomAnimation: true
        });

        // Add Zoom Control (bottom right, subtle)
        L.control.zoom({
            position: 'bottomright'
        }).addTo(map);

        // Tile Layer - CartoDB Positron (No Labels for maximum abstraction)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // State
        let activeMarker = null;
        const panel = document.getElementById('panel');
        const panelTitle = document.getElementById('panel-title');
        const panelBody = document.getElementById('panel-body');

        // Markers
        locations.forEach(loc => {
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="marker-dot idle"></div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });

            const marker = L.marker(loc.coords, { icon: icon }).addTo(map);

            marker.on('click', (e) => {
                // Pan to marker with offset for panel
                const targetPoint = map.project(e.latlng, map.getZoom()).subtract([0, 100]); // Shift map up slightly
                const targetLatLng = map.unproject(targetPoint, map.getZoom());

                map.panTo(targetLatLng, {
                    animate: true,
                    duration: 1.2,
                    easeLinearity: 0.2
                });

                showPanel(loc);
                e.originalEvent.stopPropagation();
            });
        });

        // Panel Logic
        function showPanel(data) {
            if (activeMarker === data.name && panel.classList.contains('active')) return;

            // Fade out if switching
            if (panel.classList.contains('active')) {
                panel.classList.remove('active');
                setTimeout(() => updateAndShow(data), 250);
            } else {
                updateAndShow(data);
            }
        }

        function updateAndShow(data) {
            panelTitle.innerText = data.name;
            panelBody.innerText = data.text;
            panel.classList.add('active');
            activeMarker = data.name;
        }

        function hidePanel() {
            panel.classList.remove('active');
            activeMarker = null;
        }

        // Global Interactions
        map.on('click', () => {
            hidePanel();
        });

        map.on('dragstart', () => {
            // Optional: hide panel on drag? Or keep it?
            // "Land resists haste" - keeping it allows contemplation.
            // But let's follow standard "dismiss on interact" to clear view.
            // hidePanel();
        });

        // Intro Animation
        window.addEventListener('load', () => {
            const mapEl = document.getElementById('map');
            setTimeout(() => {
                mapEl.style.opacity = '1';
            }, 100);
        });

    </script>
</body>
</html>
